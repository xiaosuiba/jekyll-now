<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="google-site-verification" content="9vIieCe-Qpd78QOmBl63rGtIVbhY6sYyuxX3j8XWBA4" />
    <meta name="baidu-site-verification" content="LRrmH41lz7" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="ChrisLi&#39;s Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://xiaosuiba.github.io/img/home-bg-natsume4.jpg">
    <meta property="twitter:image" content="https://xiaosuiba.github.io/img/home-bg-natsume4.jpg" />
    

    
    <meta name="title" content="Why rest.Storage interface have only one method" />
    <meta property="og:title" content="Why rest.Storage interface have only one method" />
    <meta property="twitter:title" content="Why rest.Storage interface have only one method" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Why rest.Storage interface have only one method-打雷不怕的博客 | ChrisLi Blog</title>

    <link rel="canonical" href="/2021/03/26/why-only-new-in-rest-storage-interface/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>
	
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
</head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">ChrisLi&#39;s Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/categories/tech">tech</a>
                    </li>
                    
                    
		    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-natsume4.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        <a class="tag" href="/tags/code" title="code">
                            code
                        </a>
                        
                    </div>
                    <h1>Why rest.Storage interface have only one method</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
			Posted by 
			
			    Chris Li
			 
			on 
			Monday, March 29, 2021
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                
                
                
                <h1 id="why-reststorage-interface-have-only-one-method">Why rest.Storage interface have only one method</h1>
<p>While reading Kubernetes source code, I found one question really bothered me for several days. The common interface of rest storage is defined in <code>/vendor/k8s.io/apiserver/pkg/registry/rest/rest.go</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Storage</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#75715e">// New returns an empty object that can be used with Create and Update after request data has been put into it.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// This object must be a pointer type for use with Codec.DecodeInto([]byte, runtime.Object)
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">New</span>() <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">Object</span>
}
</code></pre></div><p>You can see there&rsquo;s only one method <code>New</code> defined here. So how could the other actions, like <code>Get</code> or <code>List</code> etc., be completed?</p>
<p>After several day&rsquo;s search on the internet, I finally found the some code in <code>/vendor/k8s.io/apiserver/pkg/endpoints/installer.go</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">APIInstaller</span>) <span style="color:#a6e22e">registerResourceHandlers</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">storage</span> <span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Storage</span>, <span style="color:#a6e22e">ws</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">restful</span>.<span style="color:#a6e22e">WebService</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">metav1</span>.<span style="color:#a6e22e">APIResource</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">storageversion</span>.<span style="color:#a6e22e">ResourceInfo</span>, <span style="color:#66d9ef">error</span>) {
<span style="color:#f92672">...</span>..
	<span style="color:#75715e">// what verbs are supported by the storage, used to know what verbs we support per path
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">creater</span>, <span style="color:#a6e22e">isCreater</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Creater</span>)
	<span style="color:#a6e22e">namedCreater</span>, <span style="color:#a6e22e">isNamedCreater</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">NamedCreater</span>)
	<span style="color:#a6e22e">lister</span>, <span style="color:#a6e22e">isLister</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Lister</span>)
	<span style="color:#a6e22e">getter</span>, <span style="color:#a6e22e">isGetter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Getter</span>)
	<span style="color:#a6e22e">getterWithOptions</span>, <span style="color:#a6e22e">isGetterWithOptions</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">GetterWithOptions</span>)
	<span style="color:#a6e22e">gracefulDeleter</span>, <span style="color:#a6e22e">isGracefulDeleter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">GracefulDeleter</span>)
	<span style="color:#a6e22e">collectionDeleter</span>, <span style="color:#a6e22e">isCollectionDeleter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">CollectionDeleter</span>)
	<span style="color:#a6e22e">updater</span>, <span style="color:#a6e22e">isUpdater</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Updater</span>)
	<span style="color:#a6e22e">patcher</span>, <span style="color:#a6e22e">isPatcher</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Patcher</span>)
	<span style="color:#a6e22e">watcher</span>, <span style="color:#a6e22e">isWatcher</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Watcher</span>)
	<span style="color:#a6e22e">connecter</span>, <span style="color:#a6e22e">isConnecter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">Connecter</span>)
	<span style="color:#a6e22e">storageMeta</span>, <span style="color:#a6e22e">isMetadata</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">StorageMetadata</span>)
	<span style="color:#a6e22e">storageVersionProvider</span>, <span style="color:#a6e22e">isStorageVersionProvider</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">storage</span>.(<span style="color:#a6e22e">rest</span>.<span style="color:#a6e22e">StorageVersionProvider</span>)
</code></pre></div><p>see here, <code>registerResourceHandlers</code> utilizes golang type conversion to check the storage&rsquo;s abilities. So the <code>New</code> method is only a sign of rest.storage interface. The real abilities could be defined in resource storage struct as needed. The methods defined in each specific resource storage type represents its ability in the same time.</p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/03/26/kubernetes-sample-apiserver/" data-toggle="tooltip" data-placement="top" title="Kubernetes sample-apiserver 代码阅读">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/code" title="code">
                            code
                        </a>
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="ChrisLi&#39;s Blog" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:xiaosuiba@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/your%20wechat%20qr%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/xiaosuiba">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; ChrisLi&#39;s Blog , 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
       bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else{
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>







</body>
</html>
